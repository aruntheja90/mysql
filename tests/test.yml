---

- name: Test MySQL role
  hosts: all

  roles:
    - role: sansible.mysql

  post_tasks:
    - name: MySQL should be installed
      command: mysql --version
      register: mysql_version
      tags:
        - assert

    - name: Assert mysql version
      assert:
        that:
          - "'mysql  Ver 14.14 Distrib 5.5.50' in mysql_version.stdout"
      tags:
        - assert

    - name: MySQL should be running
      become: yes
      shell: service mysql status | grep "start/running"
      args:
        warn: no
      tags:
        - assert

    - name: Wait for MySQL port
      wait_for:
        port: 3306
        state: started
        timeout: 30
      tags:
        - assert
