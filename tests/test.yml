---

- name: Test MySQL role
  hosts: all

  roles:
    - role: sansible.mysql

  post_tasks:
    - name: MySQL should be installed
      command: mysql --version
      register: mysql_version
      tags:
        - assert

    - name: Assert mysql version
      assert:
        that:
          - "'{{ mysql.version }}' in mysql_version.stdout"
      tags:
        - assert

    - name: MySQL should already be started
      become: yes
      service:
        name: mysql
        state: started
      register: mysql_start_check
      failed_when: mysql_start_check.changed
      tags:
        - assert

    - name: Check for MySQL port
      wait_for:
        port: 3306
        state: started
        timeout: 30
      tags:
        - assert
